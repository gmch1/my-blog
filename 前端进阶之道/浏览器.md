## 浏览器

### 事件触发三阶段

- window到事件触发处传播，遇到注册的捕获事件会触发
- 传播到事件触发处时触发注册地事件
- 从事件触发处往window传播，遇到注册地冒泡事件会触发

事件触发一般来说会按照上面的顺序进行，但是也有特例，**如果给一个目标节点同时注册冒泡和捕获事件，事件触发会按照注册的顺序执行。**

```html
<button id="add">add</button>
<script>
    let btn = document.querySelector('#add');
    btn.onclick = () => {
        console.log(1);
    };
    btn.addEventListener('click', () => {
        console.log('冒泡事件触发');
    });

    btn.addEventListener(
        'click',
        () => {
            console.log('捕获事件触发');
        },
        false
    );
    // 实际触发顺序 1  冒泡 捕获
</script>
```

### 注册事件

通常我们使用addEventListener 注册事件，该函数第三个参数可以是布尔值，也可以是对象。对于布尔值useCapture参数来说，该参数默认为false。

useCapture 决定了注册的事件是捕获事件还是冒泡事件。对于对象参数来说，还可以使用以下几个属性：

- capture ，布尔值，决定冒泡还是捕获
- once ，布尔值，值为true表示该回调只会调用一次，调研后移除监听
- passive ，布尔值，表示永远捕获调用preventDefault 

一般来说，我们只希望事件只触发在目标上，这时候可以使用 来阻止事件的进一步传播。**通常我们认为stopPropagation 是用来阻止事件冒泡的，其实该函数也可以阻止捕获事件。**stopImmediatePropagation同样也能实现阻止事件，但是**还能阻止该事件目标执行别的注册事件。**意思就是第二次注册事件不生效。

```js
node.addEventListener(
  'click',
  event => {
    event.stopImmediatePropagation()
    console.log('冒泡')
  },
  false
)
// 点击 node 只会执行上面的函数，该函数不会执行
node.addEventListener(
  'click',
  event => {
    console.log('捕获 ')
  },
  true
)
```

### 事件代理

如果一个节点中的子节点是动态生成的，那么子节点需要注册事件的话，应该注册在父节点上。

```html
<ul id="ul">
  <li>1</li>
  <li>2</li>
  <li>3</li>
  <li>4</li>
  <li>5</li>
</ul>
<script>
  let ul = document.querySelector('##ul')
  ul.addEventListener('click', event => {
    console.log(event.target)
  })
</script>
```

事件代理的方式相对于直接给目标注册事件来说，有以下优势

- 节省内存
- 不需要给子节点注销事件

### 跨域

浏览器同源策略 端口 协议 域名 三者有一个不同就是跨域。



#### JSONP

jsonp的原理很简单，就是利用 script 标签没有跨域限制的漏洞。通过script 标签指向一个需要访问的地址，并提供一个回调函数来接受数据。

```js
<script src="http://domain/api?param1=a&param2=b&callback=jsonp"></script>
<script>
    function jsonp(data) {
    	console.log(data)
	}
</script>
```

封装jsonp

```js
function jsonp (usr, jsonpCallback, success){
    let script = document.createElement('script')
    script.src = url
    script.async = true
    script.type = 'text/javascript'
    window[jsonpCallback] = function (data){
        success&&success(data)
    }
    document.body.addendChild(script)
}
jsonp('http://xxx','callback',function(value){
    console.log(value)
})

```



#### CORS

CORS需要后端和浏览器同时支持，浏览器会自动进行CORS通信，实现CORS通信的关键是后端。

服务器端设置 Access-Control-Allow-Origin 就可以开启 CORS。该属性表示哪些域名可以访问资源，如果设置通配符，则表示所有网站都可以访问资源。



#### document.domain

该方法只能适用于二级域名相同的情况下，比如 `a.test.com` 和 `b.test.com` 适用于该方式。

只需要给页面添加 `document.domain = 'test.com'` 表示二级域名都相同就可以实现跨域

### 

#### postMessage

该方法用于获取嵌入页面中的第三方页面的数据。一个页面发送消息，另一个页面判断来源并接受消息。





